# apache/sites-available/fastapi-proxy.conf

<VirtualHost *:80>
    ServerAdmin dan.wolfson@pdr-associates.com
    ServerName localhost # Or your domain name (e.g., example.com)
    ServerAlias www.localhost # Optional, if you have a www subdomain

    # Enable proxy modules (often enabled by default in httpd image, but good to ensure)
    LoadModule proxy_module modules/mod_proxy.so
    LoadModule proxy_http_module modules/mod_proxy_http.so

    # ProxyPass and ProxyPassReverse directives
    # 'web' is the name of your FastAPI service in docker-compose.yml
    # Apache will forward requests from its root (/) to the FastAPI service on port 8000
    ProxyPreserveHost On
    ProxyPass / http://pyegeria-web:8000/
    ProxyPassReverse / http://pyegeria-web:8000/

    # Optional: If you want to serve static files directly from Apache
     Alias /static/ /var/www/html/static/
     <Directory /var/www/html/static/>
         Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    # Add headers for better proxy behavior, especially for HTTPS if you add it later
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Host $host
    RequestHeader set X-Forwarded-For $proxy_add_x_forwarded_for

    # Enable rewrite module if needed (e.g., for redirecting HTTP to HTTPS)
    # LoadModule rewrite_module modules/mod_rewrite.so
    # RewriteEngine On
    # RewriteCond %{HTTPS} off
    # RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

</VirtualHost>