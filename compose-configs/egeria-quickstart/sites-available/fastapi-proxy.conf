# apache/sites-available/fastapi-proxy.conf

<VirtualHost *:8085>
    ServerAdmin dan.wolfson@pdr-associates.com
    ServerName localhost:8085
    ServerAlias www.localhost

    # Serve site content from Apache's htdocs
    DocumentRoot "/usr/local/apache2/htdocs"
    <Directory "/usr/local/apache2/htdocs">
        Options Indexes FollowSymLinks Includes ExecCGI
        AllowOverride None
        Require all granted
    </Directory>

    # Only proxy specific FastAPI endpoints; do not proxy the entire site
    <Location "/dr-egeria/process">
        ProxyPreserveHost On
        ProxyPass http://pyegeria-web:8000/dr-egeria/process
        ProxyPassReverse http://pyegeria-web:8000/dr-egeria/process
        Require all granted
    </Location>

    # Optional: If you want to serve static files from another location
    Alias /static/ /var/www/html/static/
    <Directory /var/www/html/static/>
        Require all granted
    </Directory>

    ErrorLog /usr/local/apache2/logs/error.log
    CustomLog /usr/local/apache2/logs/access.log combined

    # Add headers for better proxy behavior
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Host "%{Host}i"

</VirtualHost>